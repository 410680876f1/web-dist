import{a as F,h as t,bu as j,a1 as E,aI as V,a2 as o,I as b,bG as J,T as P,bw as Q,dp as z,S as w,F as K,bH as U,b as W,a$ as v,bg as f,m as X,ck as T,k as Y,bM as Z,a8 as p,dq as ee,c_ as te,c$ as ne,ac as re,H as _,G as x,C as ae,n as O,Q as ie,bh as y,af as de}from"./index-d777c8ff.js";import{T as d}from"./item_type-32dc6fdf.js";import{R as ue}from"./ResponsiveGrid-ab0d9643.js";const $=e=>{const u=F();return t(U,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(j,{get for(){return e.name},display:"flex",alignItems:"center",get children(){return u(e.full_name_path??e.driver==="common"?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(E,{get fallback(){return t(V,{get children(){return u("settings.unknown_type")}})},get children(){return[t(o,{get when(){return e.type===d.String},get children(){return t(b,{get id(){return e.name},get type(){return e.name=="password"?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===d.String?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i.currentTarget.value)}:void 0}})}}),t(o,{get when(){return e.type===d.Number},get children(){return t(b,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===d.Number?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,parseInt(i.currentTarget.value))}:void 0}})}}),t(o,{get when(){return e.type===d.Float},get children(){return t(b,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===d.Float?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,parseFloat(i.currentTarget.value))}:void 0}})}}),t(o,{get when(){return e.type===d.Bool},get children(){return t(J,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===d.Bool?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i.currentTarget.checked)}:void 0}})}}),t(o,{get when(){return e.type===d.Text},get children(){return t(P,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===d.Text?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i.currentTarget.value)}:void 0}})}}),t(o,{get when(){return e.type===d.Select},get children(){return t(Q,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===d.Select?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i)}:void 0},get children(){return t(z,{get readonly(){return e.readonly},get searchable(){return e.type===d.Select&&e.searchable},get options(){return e.options.split(",").map(i=>({key:i,label:u((e.options_prefix??(e.driver==="common"?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`))+`.${i}`)}))}})}})}})]}}),t(w,{get when(){return e.help},get children(){return t(K,{get children(){return u(e.driver==="common"?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function I(e,u){switch(e){case d.Bool:return u?u==="true":!1;case d.Number:return u?parseInt(u):0;default:return u||""}}const se=()=>{const e=F(),{params:u,back:i,to:a}=W(),{id:l}=u,[L,R]=v(()=>f.get("/admin/driver/list"),!0),[c,C]=X({}),A=async()=>{const n=await R();y(n,C)},[B,N]=v(()=>f.get(`/admin/storage/get?id=${l}`),!0),[q,D]=v(()=>f.get(`/admin/driver/info?driver=${g.driver}`),!0);l?(async()=>{const n=await N();y(n,async r=>{s(r),m(JSON.parse(r.addition));const h=await D();y(h,M=>C({[g.driver]:M}))})})():A();const[g,s]=T({}),[S,m]=T({}),[G,H]=v(()=>(s("addition",JSON.stringify(S)),f.post(`/admin/storage/${l?"update":"create"}`,g))),k=Y(()=>{var r;const n=(r=c()[g.driver])==null?void 0:r.config.alert;if(console.log(n),n)return n.split("|")[0]});return t(de,{get loading(){return l?B()||q():L()},get children(){return[t(Z,{mb:"$2",get children(){return e(`global.${l?"edit":"add"}`)}}),t(p,{mb:"$2",spacing:"$2",get children(){return[t($,{name:"driver",default:"",readonly:l!==void 0,required:!0,searchable:!0,get type(){return d.Select},get options(){return l?g.driver:Object.keys(c()).join(",")},get value(){return g.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:n=>{for(const r of c()[n].common)s(r.name,I(r.type,r.default));m(ee(r=>{for(const h in r)delete r[h]}));for(const r of c()[n].additional)m(r.name,I(r.type,r.default));s("driver",n)}}),t(w,{get when(){return k()},get children(){return t(te,{get status(){return k()},w:"$full",get children(){return[t(ne,{}),re(()=>e(`drivers.config.${g.driver}.alert`))]}})}})]}}),t(ue,{get children(){return t(w,{get when(){return c()[g.driver]},get children(){return[t(_,{get each(){return c()[g.driver].common},children:n=>t($,x(n,{driver:"common",get value(){return g[n.name]},onChange:r=>{s(n.name,r)}}))}),t(_,{get each(){return c()[g.driver].additional},children:n=>t($,x(n,{get driver(){return g.driver},get value(){return S[n.name]},onChange:r=>{m(n.name,r)}}))})]}})}}),t(ae,{mt:"$2",get loading(){return G()},onClick:async()=>{c()[g.driver].config.need_ms&&(O.info(e("manage.add_storage-tips")),window.open(ie("/@manage/messenger"),"_blank"));const n=await H();y(n,()=>{O.success(e("global.save_success")),i()},(r,h)=>{n.data.id&&a(`/@manage/storages/edit/${n.data.id}`)})},get children(){return e(`global.${l?"save":"add"}`)}})]}})};export{se as default};
