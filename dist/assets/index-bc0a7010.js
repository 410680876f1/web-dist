import{c7 as ge,G as H,c8 as J,c9 as k,ap as W,Y as B,h as e,ae as R,ad as I,V as S,b as Z,c3 as _,ca as $,e as de,aE as q,bg as C,bU as pe,cb as he,cc as fe,cd as me,ce as we,a as be,k as Ce,m,cf as _e,a$ as T,o as $e,a8 as ve,bN as U,aB as ye,bM as xe,S as w,I as O,b1 as j,a7 as Se,al as ke,C as z,br as Ie,bs as Ge,cg as Le,aI as Ee,n as b,bh as Ae,ch as V}from"./index-d777c8ff.js";import{a as Me}from"./useTitle-18cbd1b3.js";import{s as Pe,g as Re,a as Te}from"./webauthn-json.browser-ponyfill-f2f06d6e.js";const Ue="https://github.com/alist-org/alist";function Oe(s){return ge(`${s}-${Ue}`)}const ze=W('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Be=s=>{const g=H({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{const n=ze.cloneNode(!0),u=n.firstChild,d=u.firstChild,r=d.nextSibling,c=r.firstChild,a=c.nextSibling;return J(t=>{const i=g.startColor,p=g.endColor;return i!==t._v$&&k(c,"stop-color",t._v$=i),p!==t._v$2&&k(a,"stop-color",t._v$2=p),t},{_v$:void 0,_v$2:void 0}),n})()},Ne=W('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Fe=s=>{const g=H({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{const n=Ne.cloneNode(!0),u=n.firstChild,d=u.firstChild,r=d.nextSibling,c=r.firstChild,a=c.nextSibling;return J(t=>{const i=g.startColor,p=g.endColor;return i!==t._v$&&k(c,"stop-color",t._v$=i),p!==t._v$2&&k(a,"stop-color",t._v$2=p),t},{_v$:void 0,_v$2:void 0}),n})()},Ke=()=>{const s=B("#a9c6ff","#062b74");return e(R,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(R,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(Fe,{})}}),e(R,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Be,{})}})]}})},De=()=>{const s=I("sso_login_enabled"),g=S("sso_login_platform"),n=I("sso_compatibility_mode"),{searchParams:u,to:d}=Z(),r=u.token;r!=null&&r!=""&&(_(r),d(decodeURIComponent(u.redirect||$||"/"),!0));function c(a){const t=a.data;t.token&&(_(t.token),d(decodeURIComponent(u.redirect||$||"/"),!0))}if(window.addEventListener("message",c),de(()=>{window.removeEventListener("message",c)}),s){const a=()=>{const i=C.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=i;return}window.open(i,"authPopup","width=500,height=600")};let t;switch(g){case"Github":t=we;break;case"Microsoft":t=me;break;case"Google":t=fe;break;case"Dingtalk":t=he;break;default:t=pe}return e(q,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:a})}},Je=()=>{const s=S("logo").split(`
`),g=B(s[0],s.pop()),n=be(),u=Ce(()=>`${n("login.login_to")} ${S("site_title")}`);Me(u);const d=B("white","$neutral1"),[r,c]=m(localStorage.getItem("username")||""),[a,t]=m(localStorage.getItem("password")||""),[i,p]=m(""),[v,Y]=m(!1),[y,Q]=_e("remember-pwd","false"),[G,N]=m(!1),[X,ee]=T(async()=>G()?C.post("/auth/login/ldap",{username:r(),password:a(),otp_code:i()}):C.post("/auth/login/hash",{username:r(),password:Oe(a()),otp_code:i()})),[,te]=T((o,l,f,P)=>C.post("/authn/webauthn_finish_login?username="+f,JSON.stringify(l),{headers:{session:o},signal:P})),[,ne]=T((o,l)=>C.get("/authn/webauthn_begin_login?username="+o,{signal:l})),{searchParams:L,to:E}=Z(),oe=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,re=I("webauthn_login_enabled"),se=async()=>{Y(!v())};let x=null;const F=async o=>{if(!Pe()){o||b.error(n("users.webauthn_not_supported"));return}if(o&&!await oe())return;x==null||x.abort();const l=new AbortController;x=l;const f=o?"":r();!o&&y()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const P=await ne(f,l.signal);Ae(P,async D=>{try{const h=Re(D.options);h.signal=l.signal,o&&(h.mediation="conditional");const le=await Te(h),ce=await te(D.session,le,f,l.signal);V(ce,ue=>{b.success(n("login.success")),_(ue.token),E(decodeURIComponent(L.redirect||$||"/"),!0)})}catch(h){h instanceof Error&&h.name!="AbortError"&&b.error(h.message)}})},A=async()=>{if(v())await F();else{y()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const o=await ee();V(o,l=>{b.success(n("login.success")),_(l.token),E(decodeURIComponent(L.redirect||$||"/"),!0)},(l,f)=>{!M()&&f===402?ae(!0):b.error(l)})}},[M,ae]=m(!1),K=I("ldap_login_enabled"),ie=S("ldap_login_tips");return K&&N(!0),$e(()=>{F(!0)}),e(Ee,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ve,{get bgColor(){return d()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(U,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ye,{mr:"$2",boxSize:"$12",get src(){return g()}}),e(xe,{color:"$info9",fontSize:"$2xl",get children(){return u()}})]}}),e(w,{get when(){return!M()},get fallback(){return e(O,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return i()},onInput:o=>p(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&A()}})},get children(){return[e(O,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:o=>c(o.currentTarget.value)}),e(w,{get when(){return!v()},get children(){return e(O,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return a()},onInput:o=>t(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&A()}})}}),e(U,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(j,{get checked(){return y()==="true"},onChange:()=>Q(y()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(Se,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),e(ke,{w:"$full",spacing:"$2",get children(){return[e(w,{get when(){return!v()},get children(){return e(z,{colorScheme:"primary",w:"$full",onClick:()=>{M()?p(""):(c(""),t(""))},get children(){return n("login.clear")}})}}),e(z,{w:"$full",get loading(){return X()},onClick:A,get children(){return n("login.login")}})]}}),e(w,{when:K,get children(){return e(j,{w:"$full",get checked(){return G()===!0},onChange:()=>N(!G()),children:ie})}}),e(z,{w:"$full",colorScheme:"accent",onClick:()=>{_(),E(decodeURIComponent(L.redirect||$||"/"),!0)},get children(){return n("login.use_guest")}}),e(U,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Ie,{}),e(Ge,{}),e(De,{}),e(w,{when:re,get children(){return e(q,{cursor:"pointer",boxSize:"$8",as:Le,p:"$0_5",onclick:se})}})]}})]}}),e(Ke,{})]}})};export{Je as default};
